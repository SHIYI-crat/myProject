# NodeJs + VueJs (Express + ElementUI) 全栈开发王者荣耀手机端官网和管理后台



## 一、 入门
1. 项目介绍

1. 工具安装和环境搭建(nodejs,npm,mongodb)

1. 初始化项目:

* 创建项目
* `mkdir server`创建server文件夹
* `vue create web`初始化web端
* `vue create admin`初始化后台管理
* 进入server文件夹 `npm init -y`初始化项目
* 在server文件夹下新建index.js文件夹(服务端的入口文件)
* 在server文件夹下package.json中新增`"serve": "nodemon index.js",`



## 二、 管理后台

1. 基于Element UI的后台管理基础界面搭建

   * `cd admin`进入后台管理文件夹

   * ` vue add element`增添组件库

   * `vue add router`增添路由

   * 从element ui中复用组件

   * 关闭eslint检查：

     * 创建vue.config.js文件夹

     * ~~~js
       module.exports = {
       	lintOnSave: false, //关闭语法检查
       }
       ~~~

     * 一定要重启项目！！！

1. 创建分类

   * 调整代码
   * 在`<el-menu router :default-openeds="['1', '3']">`中添加**router**实现跳转
   * `npm i axios`请求提交接口
   * 配置好服务端，前端设置发送请求方法

1. 分类列表

   * 从element ui中复用组件

1. 修改分类

   * 和创建分类复用一套代码

   * `{{ id ? "编辑" : "新建" }}分类`

   * ~~~js
     if (this.id) {
             res = await this.$http.put(`/categories/${this.id}`, this.model);
           } else {
             res = await this.$http.post("categories", this.model);
           }
     ~~~

1. 删除分类

   * ~~~js
     async remove(row) {
           this.$confirm(`是否确定要删除分类"${row.name}"`, "提示", {
             confirmButtonText: "确定",
             cancelButtonText: "取消",
             type: "warning",
           }).then(async () => {
             const res = await this.$http.delete(`categories/${row._id}`);
             this.$message({
               type: "success",
               message: "删除成功!",
             });
             this.fetch();
           });
         },
     ~~~

1. 子分类

   * 关联操作

   * `parent: { type: mongoose.SchemaTypes.ObjectId, ref: 'Category' }`

   * ~~~js
     router.get('/categories', async (req, res) => {
             const items = await Category.find().populate('parent').limit(10)
             res.send(items)
         })
     ~~~

1. **通用 CRUD 接口**

   * ` npm i inflection`用于将命名一一对应

   * 定义中间件并将crud接口改为通用接口：

   * ~~~js
     app.use('/admin/api/rest/:resource', async (req, res, next) => {
             const modelName = require('inflection').classify(req.params.resource)
             req.Model = require(`../../models/${modelName}`)
             next()
         }, router)
     ~~~

   * 对升级分类接口单独进行设置，添加判断

1. 装备管理

   * 复用分类创建和列表文件，由于已经存在通用crud接口，服务端配置model即可

1. 图片上传 (multer)

   * 复用element UI组件

   * server端路由下index.js` npm i multer`

   * ~~~js
     const multer = require('multer')
         const upload = multer({ dest: __dirname + '/../../uploads' })
         app.post('/admin/api/upload', upload.single('file'), async (req, res) => {
             const file = req.file
             file.url = `http://localhost:3000/uploads/${file.filename}`
             res.send(file)
         })
     ~~~

   * server端添加文件uploads

1. 英雄管理

   * 复用分类创建和列表文件，由于已经存在通用crud接口，服务端配置model即可

1. 编辑英雄 (关联,多选,el-select, multiple)

    * model中hero里添加数据类型，el-rate用于星级打分
    * 数据是关联数据库中已有信息`type: mongoose.SchemaTypes.ObjectId,`
    * `el-select  --  multiple`实现下拉菜单多选

1. 技能编辑

    * `el-tabs -- type="border-card"`实现表格分卡片布局
    * `@click="model.skills.push({})`实现技能新增
    * `@click="model.skills.splice(i, 1)`实现技能删除

1. 文章管理

   * 复用英雄创建和列表文件，由于已经存在通用crud接口，服务端配置model即可

1. 富文本编辑器 (quill)

   * https://www.npmjs.com/package/vue2-editor

   * `npm install vue2-editor` 使用富文本编辑器(实质是添加样式转换为html标签)
   * 图片问题采用`handleImageAdded`方法解决

1. 首页广告管理

   * 复用英雄创建和列表文件，由于已经存在通用crud接口，服务端配置model即可

1. 管理员账号管理 (bcrypt)

   * 复用分类创建和列表文件，由于已经存在通用crud接口，服务端配置model即可

   * `npm i bcrypt`  安装密码加密包实现不可见

   * ~~~js
     password: {
             type: String,
             set(val) {
                 return require('bcrypt').hashSync(val, 10)
             }
         },
     ~~~

1. 登录页面

   * 复用分类创建和列表文件

1. 登录接口 (jwt,jsonwebtoken)

   * ` npm i jsonwebtoken`  使用jsonwebtoken进行登录校验

   * ~~~js
     app.post('/admin/api/login', async (req, res) => {
             const { username, password } = req.body
             // 1、根据用户名找用户
             const AdminUser = require('../../models/AdminUser')
             const user = await AdminUser.findOne({ username }).select('+password')
             if (!user) {
                 return res.status(422).send({
                     message: '用户不存在'
                 })
             }
     
             // 2、校验密码
             const isValid = require('bcrypt').compareSync(password, user.password)
             if (!isValid) {
                 return res.status(422).send({
                     message: '密码错误'
                 })
             }
     
             // 3、返回token
             const jwt = require('jsonwebtoken')
             const token = jwt.sign({ id: user._id }, app.get('secret'))
             res.send({ token })
         })
     ~~~

1. 服务端登录校验

   * `npm install http-assert` 使用http-assert方法
   * 封装抽离出中间件并使用

1. 客户端路由限制 (beforeEach, meta)

   * 前置路由守卫

   * ~~~js
     router.beforeEach((to, from, next) => {
       if (!to.meta.isPublic && !localStorage.token) {
         return next('/login')
       }
       next()
     })
     ~~~

1. 上传文件的登录校验 (el-upload, heades)

   * 混入mixin --  hearder
   * 计算属性 url



## 三、移动端网站

1. "工具样式"概念和 SASS (SCSS)
1. 样式重置
1. 网站色彩和字体定义 (colors, text)
1. 通用flex布局样式定义 (flex)
1. 常用边距定义 (margin, padding)
1. 主页框架和顶部菜单
1. 首页顶部轮播图片 (vue swiper)
1. 使用精灵图片 (sprite)
1. 使用字体图标 (iconfont)
1. 卡片组件 (card)
1. 列表卡片组件 (list-card, nav, swiper)
1. 首页新闻资讯-数据录入(+后台bug修复)
1. 首页新闻资讯-数据接口
1. 首页新闻资讯-界面展示
1. 首页英雄列表-提取官网数据
1. 首页英雄列表-录入数据
1. 首页英雄列表-界面展示
1. 新闻详情页
1. 新闻详情页-完善
1. 英雄详情页-1-前端准备
1. 英雄详情页-2-后台编辑
1. 英雄详情页-3-前端顶部
1. 英雄详情页-4-完善



## 四、发布和部署 (阿里云)

1. 生产环境编译
1. 购买域名和服务器
1. 域名解析
1. Nginx 安装和配置
1. MongoDB数据库的安装和配置
1. git 安装、配置ssh-key
1. Node.js 安装、配置淘宝镜像
1. 拉取代码，安装pm2并启动项目
1. 配置 Nginx 的反向代理
1. 迁移本地数据到服务器 (mongodump)



## 五、进阶

1. 使用免费SSL证书启用HTTPS安全连接
1. 使用阿里云OSS云存储存放上传文件